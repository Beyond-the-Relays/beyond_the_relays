
namespace = btr_ilos

# Intital popup - maybe if ilos is not available a random planet is chosen?
country_event = {
	id = btr_ilos.1
	title = btr_ilos.1.name
	desc = btr_ilos.1.desc 
	picture = btr_GFX_evt_ilos_orbit
	is_triggered_only = yes
	trigger = {
		OR = {
			any_planet = {
				has_planet_flag = "btr_prothean_remnant_planet_ilos"
				NOR = {
					is_colony = yes
					is_capital = yes
					solar_system = {
						has_owner = yes
					}
				}
			}
			any_planet = {
				OR = {
					is_planet_class = pc_continental
					is_planet_class = pc_tropical
					is_planet_class = pc_ocean
					is_planet_class = pc_arctic
					is_planet_class = pc_tundra
					is_planet_class = pc_desert
					is_planet_class = pc_arid
				}
				NOR = {
					is_colony = yes
					is_capital = yes
					solar_system = {
						has_owner = yes
					}
				}
			}
		}
		
		event_target:btr_citadel_planet = {
			OR = {
				is_colony = yes
				is_capital = yes
			}
		}
		is_galactic_community_formed = yes
		NOT = {
			has_country_flag = ilos_event
		}
	}
	immediate = {
		set_country_flag = ilos_event
		set_global_flag = ilos_event
		random_planet = {
			limit = {
				OR = {
					has_planet_flag = "btr_prothean_remnant_planet_ilos"
					is_planet_class = pc_continental
					is_planet_class = pc_tropical
					is_planet_class = pc_ocean
					is_planet_class = pc_arctic
					is_planet_class = pc_tundra
					is_planet_class = pc_desert
					is_planet_class = pc_arid
				}
				NOR = {
					is_colony = yes
					is_capital = yes
					solar_system = {
						has_owner = yes
					}
				}		
			}
			weights = {
				base = 1
				modifier = { add = 1000 has_planet_flag = "btr_prothean_remnant_planet_ilos" }
			}
			save_global_event_target_as = btr_ilos_planet
			solar_system = {
				save_global_event_target_as = btr_refuge_system
			}
		}
	}
	option = {
		name = UNDERSTOOD
		enable_special_project = {
			name = "ILOS_INVESTIGATION"
			location = event_target:btr_ilos_planet
			owner = root
		}
	}
}

# Ship arrives at planet - picks up prothean ruins on the surface
ship_event = {
	id = btr_ilos.2
	title = btr_ilos.2.name
	desc = btr_ilos.2.desc
	picture = btr_GFX_evt_ilos_dig_site
	is_triggered_only = yes

	option = {
		name = UNDERSTOOD
		event_target:btr_ilos_planet = {
			create_archaeological_site = ilos_dig_site
		}
		hidden_effect = {
			if = {
				limit = {
					event_target:btr_refuge_system = {
						has_owner = no
					}
				}
				event_target:btr_refuge_system = {
					create_starbase = {
						size = starbase_outpost
						owner = root.owner
					}
				}
			}
		}
		#if = {
		#	limit = {
		#		distance_to_empire = {
		#			who = root.owner
		#			distance >= 50 
		#		}
		#	}
		#	owner = { add_resource = { influence = 350 } }
		#}
	}
}

# If another empire colonises/owns system while project is active
country_event = {
	id = btr_ilos.3
	title = btr_ilos.3.name
	desc = btr_ilos.3.desc
	picture = btr_GFX_evt_ilos_orbit
	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
	}
}

# Dig Site 1
fleet_event = {
	id = btr_ilos.4
	title = btr_ilos.4.name
	desc = btr_ilos.4.desc
	picture = btr_GFX_evt_ilos_drop
	archaeology = yes
	is_triggered_only = yes
	show_sound = event_mako_landing_01
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = CONTINUE
	}
}

# Dig Site 2
fleet_event = {
	id = btr_ilos.5
	title = btr_ilos.4.name
	desc = btr_ilos.5.desc
	picture = btr_GFX_evt_ilos_2
	archaeology = yes
	is_triggered_only = yes
	show_sound = event_wind_ruins
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = EXCELLENT
		owner = {
			add_resource = {
				minor_artifacts = 5
			}
		}
	}
}

# Dig Site 3
fleet_event = {
	id = btr_ilos.6
	title = btr_ilos.4.name
	desc = btr_ilos.6.desc
	picture = btr_GFX_evt_ilos_1
	archaeology = yes
	is_triggered_only = yes
	show_sound = event_collapsing_ruins
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = UNDERSTOOD
	}
}

# Dig Site 4
fleet_event = {
	id = btr_ilos.7
	title = btr_ilos.4.name
	desc = btr_ilos.7.desc
	picture = btr_GFX_evt_ilos_4
	archaeology = yes
	is_triggered_only = yes
	show_sound = event_door_opening
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = CONTINUE
	}
}

# Dig Site 5 - find vigil
fleet_event = {
	id = btr_ilos.8
	title = btr_ilos.4.name
	desc = btr_ilos.8.desc
	picture = btr_GFX_evt_ilos_6
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = UNDERSTOOD
		hidden_effect = {
			owner = {
				country_event = { id = btr_ilos.9 }
			}	
		}
	}
}

# Talk to Vigil - add audio
country_event = {
	id = btr_ilos.9
	title = btr_ilos.10.name # Prothean VI or Vigil
	desc = btr_ilos.9.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_01
	option = {
		name = btr_ilos.9.a # How are you speaking our language?
		hidden_effect = {
			country_event = { id = btr_ilos.10 }
			set_country_flag = reaper_knowledge
		}
	}
}

# Talk to Vigil 2
country_event = {
	id = btr_ilos.10
	title = btr_ilos.10.name
	desc = btr_ilos.10.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_02
	option = {
		name = btr_ilos.10.a # What are you? - Investigate
		trigger = {
			NOT = { has_country_flag = vigil_investigate_1 }
		}
		hidden_effect = {
			set_country_flag = vigil_investigate_1
			country_event = { id = btr_ilos.11 }
		}
	}
	option = {
		name = btr_ilos.10.b # What do you want?
		hidden_effect = {
			country_event = { id = btr_ilos.12 }
		}
	}
	option = {
		name = btr_ilos.10.c # Get to the point!
		trigger = {
			OR = {
				has_ethic = ethic_authoritarian
				has_ethic = ethic_fanatic_authoritarian
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		hidden_effect = {
			country_event = { id = btr_ilos.12 }
		}
	}
}

# Vigil - what are you
country_event = {
	id = btr_ilos.11
	title = btr_ilos.10.name
	desc = btr_ilos.11.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_03
	option = {
		name = btr_ilos.10.b # What do you want?
		hidden_effect = {
			country_event = { id = btr_ilos.12 }
		}
	}
	option = {
		name = btr_ilos.10.c # Get to the point!
		trigger = {
			OR = {
				has_ethic = ethic_authoritarian
				has_ethic = ethic_fanatic_authoritarian
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		hidden_effect = {
			country_event = { id = btr_ilos.12 }
		}
	}
}

# Vigil - what do you want
country_event = {
	id = btr_ilos.12
	title = btr_ilos.10.name
	desc = btr_ilos.12.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_04
	immediate = {
		event_target:citadel_system = { 
			surveyed = {
				set_surveyed = yes # test this!
			}
		}
	}
	option = {
		name = btr_ilos.12.a
		trigger = {
			NOT = { has_country_flag = vigil_investigate_2 }
		}
		hidden_effect = {
			set_country_flag = vigil_investigate_2
			country_event = { id = btr_ilos.13 } # How do the Reaper survive out in dark space? - Investigate
		}
	}
	option = {
		name = btr_ilos.12.b # Reapers could wipe of the Citadel council
		hidden_effect = {
			country_event = { id = btr_ilos.14 }
		}
	}
}

# Vigil Reapers in dark space?
country_event = {
	id = btr_ilos.13
	title = btr_ilos.10.name
	desc = btr_ilos.13.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_05
	option = {
		name = btr_ilos.12.b # Reapers could wipe of the Citadel council
		hidden_effect = {
			country_event = { id = btr_ilos.14 }
		}
	}
} 

# Vigil Reapers could wipe of the Citadel council
country_event = {
	id = btr_ilos.14
	title = btr_ilos.10.name
	desc = btr_ilos.14.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_06
	option = {
		name = btr_ilos.14.a 
		hidden_effect = {
			country_event = { id = btr_ilos.15 } # You didn't surrender? 
		}
	}
	option = {
		name = btr_ilos.14.b 
		hidden_effect = {
			country_event = { id = btr_ilos.16 } # All of you? 
		}
	}
} 

# You didn't surrender
country_event = {
	id = btr_ilos.15
	title = btr_ilos.10.name
	desc = btr_ilos.15.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_07
	option = {
		name = btr_ilos.16.a 
		hidden_effect = {
			random_list = {
				60 = { country_event = { id = btr_ilos.17 } }
				40 = { country_event = { id = btr_ilos.18 } }
			}
		}
	}
} 

# All of you
country_event = {
	id = btr_ilos.16
	title = btr_ilos.10.name
	desc = btr_ilos.16.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_08
	option = {
		name = btr_ilos.16.a # How did you manage to stay hidden
		hidden_effect = {
			random_list = {
				60 = { country_event = { id = btr_ilos.17 } }
				40 = { country_event = { id = btr_ilos.18 } }
			}
		}
	}
} 

# Protheans survive
country_event = {
	id = btr_ilos.17
	title = btr_ilos.10.name
	desc = btr_ilos.17.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_09
	option = {
		name = btr_ilos.17.a 
		hidden_effect = {
			country_event = { id = btr_ilos.19 } # Did anyone survive?
		}
	}
} 

# None survive
country_event = {
	id = btr_ilos.18
	title = btr_ilos.10.name
	desc = btr_ilos.18.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	show_sound = event_vigil_10
	option = {
		name = btr_ilos.17.a 
		hidden_effect = {
			country_event = { id = btr_ilos.22 } # Did anyone survive?
		}
	}
} 

# Protheans survive - end of dialog
country_event = {
	id = btr_ilos.19
	title = btr_ilos.10.name
	desc = btr_ilos.19.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	option = {
		name = btr_ilos.19.a
		hidden_effect = {
			country_event = { id = btr_ilos.20 } # OK
		}
		default_hide_option = yes
	}
} 

# Protheans survive - end of dialog
country_event = {
	id = btr_ilos.20
	title = btr_ilos.4.name
	desc = btr_ilos.20.desc
	picture = btr_GFX_evt_ilos_pods
	is_triggered_only = yes
	option = {
		name = UNDERSTOOD 
		hidden_effect = {
			country_event = { id = btr_ilos.21 days = 5 }
		}
	}
} 

# Spawn Prothean Empire
country_event = {
	id = btr_ilos.21
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:btr_ilos_planet = {
			create_species = {
				name = "Prothean"
				plural = "Protheans"
				class = "PRO"
				portrait = "prothean"
				namelist = btr_prothean
				traits = {
					trait="trait_quick_learners"
					trait="trait_repugnant"
					trait="mec_asari_trait_biotic"
					trait="trait_decadent"
					trait="trait_traditional"
				}
			}
			last_created_species = {
				save_global_event_target_as = protheanSpecies
			}
			create_leader = {
				class = ruler
				species = event_target:protheanSpecies
				gender = male
				name="Anartun Tyri"
			}
			create_country = {
				name_list = btr_prothean
				species = last_created
				type = default
				authority = auth_dictatorial
				civics = {
					civic =  "civic_efficient_bureaucracy"
					civic =  "civic_nationalistic_zeal"
				}
				origin = "origin_default" # change - add mofifiers here?
				flag = {
					icon={
						category="masseffect"
						file="prothean.dds"
					}
					background={
						category="backgrounds"
						file="00_solid.dds"
					}
					colors={
						"red"
						"yellow"
						"null"
						"null"
					}
				}
				ethos = {
					ethic = ethic_authoritarian
					ethic = ethic_xenophobe
					ethic = ethic_militarist
				}
				ignore_initial_colony_error = yes
			}
			last_created_country = {
				set_graphical_culture = avian_01
				save_global_event_target_as = prothean_remnant # - add mofifiers here?
				set_country_flag = prothean_remnant
				set_country_flag = btr_empire
				set_country_flag = reaper_knowledge 
				set_name = "Prothean Remnant"
				set_leader = last_created_leader
			}
			set_owner = event_target:prothean_remnant
			generate_btr_major_empire_start_buildings = yes
			while = {
				count = 10
				create_pop = { species = event_target:protheanSpecies }
			}
			solar_system = {
				starbase = {
					set_owner = event_target:prothean_remnant
				}
			}
		}
		ROOT = {
			establish_communications_no_message = event_target:prothean_remnant
		}	
		add_resource = {
			unity = 5000
			influence = 250
		}
		country_event = { id = btr_ilos.24 days = 5 }
	}
}

country_event = {
	id = btr_ilos.24
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:prothean_remnant = {
			add_resource = {
				energy = 15000
				alloys = 10000
				minerals = 15000
				food = 15000
				influence = 500
				consumer_goods = 15000
				physics_research = 100000
				engineering_research = 100000
				society_research = 100000
			}
			add_modifier = {
				modifier = prothean_remnant
			}
			add_opinion_modifier = {
				who = root
				modifier = awakened_prothean_empire
			}
		}
	}
}

# Last message - end of dialog
country_event = {
	id = btr_ilos.22
	title = btr_ilos.10.name
	desc = btr_ilos.22.desc
	picture_event_data = {
		room = vigil_room
	}
	is_triggered_only = yes
	force_open = yes
	diplomatic = yes
	option = {
		name = btr_ilos.22.a 
		hidden_effect = {
			country_event = { id = btr_ilos.23 } # Goodbye
		}
		default_hide_option = yes
	}
} 

# Find Relic
country_event = {
	id = btr_ilos.23
	title = btr_ilos.4.name
	desc = btr_ilos.23.desc
	picture = btr_GFX_evt_ilos_6
	is_triggered_only = yes
	option = {
		name = EXCELLENT
		add_relic = r_prothean_sphere
	}
} 