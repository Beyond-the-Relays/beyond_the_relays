
namespace = btr_citadel

# Entering Widow system first time 
ship_event = {
	id = btr_citadel.1
	title = btr_citadel.1.name
	desc = btr_citadel.1.desc
	picture = btr_GFX_evt_citadel_1
	location = FROM
	is_triggered_only = yes

	trigger = {
		FROM = {
			has_star_flag = widow_system
			any_system_planet = { has_planet_flag = btr_citadel }
		}
	}

	immediate = {
		FROM = { save_global_event_target_as = citadel_system }
		event_target:citadel_system = {
			random_planet = {
				limit = { has_planet_flag = btr_citadel }
				save_global_event_target_as = btr_citadel_planet
			}
		}
	}

	option = {
		name = btr_citadel.1.a # Already surveyed - Amazing
		trigger = {
			event_target:citadel_system = { has_star_flag = citadel_dig_site_spawned }
		}
	}

    option = {
		name = btr_citadel.1.b # not surveyed - investigate
		trigger = {
			NOR = { 
				event_target:citadel_system = { has_star_flag = citadel_dig_site_spawned }
				owner = {
					OR = {
						has_country_flag = geth_consensus
						has_country_flag = rachni_hive
						has_country_flag = collectors
                        has_country_flag = prothean_remnant
					}
				} 
			}
		}
		hidden_effect = {
			event_target:citadel_system = { 
				set_star_flag = "citadel_dig_site_spawned" 
			}
			event_target:btr_citadel_planet = {
				create_archaeological_site = citadel_dig_site
			}
			owner = { set_country_flag = "discovered_citadel_first" }
		}
	}
}

# Dig Site 1 # todo add sound effects
fleet_event = {
	id = btr_citadel.2
	title = btr_citadel.2.name
	desc = btr_citadel.2.desc
	picture = btr_GFX_evt_citadel_2
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = btr_citadel.2.a
	}
}

# Dig site 2
fleet_event = {
	id = btr_citadel.3
	title = btr_citadel.2.name
	desc = btr_citadel.3.desc
	picture = btr_GFX_evt_citadel_hangar_1
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = btr_citadel.3.a
		leader = { add_experience = 50 }
	}
}

# Dig site 3
fleet_event = {
	id = btr_citadel.4
	title = btr_citadel.2.name
	desc = btr_citadel.4.desc
	picture = btr_GFX_evt_citadel_presidium
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = btr_citadel.4.a
		leader = { add_experience = 50 }
	}
}

# Dig site 4
fleet_event = {
	id = btr_citadel.5
	title = btr_citadel.2.name
	desc = btr_citadel.5.desc
	picture = btr_GFX_evt_citadel_computer
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = btr_citadel.5.a
		leader = { add_experience = 50 }
		owner = {
			add_resource = {
				engineering_research = 500
			}
		}
	}
}

# Dig site 5
fleet_event = {
	id = btr_citadel.6
	title = btr_citadel.2.name
	desc = btr_citadel.6.desc
	picture = btr_GFX_evt_citadel_council_chamber
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = btr_citadel.6.a
		leader = { add_experience = 50 }
	}
}

# Dig site 6
fleet_event = {
	id = btr_citadel.7
	title = btr_citadel.2.name
	desc = btr_citadel.7.desc
	picture = btr_GFX_evt_citadel_wards_1
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = btr_citadel.7.a
		leader = { add_experience = 50 }
	}
}

# Dig site 7
fleet_event = {
	id = btr_citadel.8
	title = btr_citadel.2.name
	desc = btr_citadel.8.desc
	picture = btr_GFX_evt_citadel_1
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		fromfrom = { set_site_progress_locked = yes }
	}
	after = {
		fromfrom = { set_site_progress_locked = no }
	}
	option = {
		name = btr_citadel.8.a
		leader = { add_experience = 50 }
		owner = {
			add_resource = {
				unity = 500
			}
		}
		hidden_effect = { owner = { country_event = { id = btr_citadel.9 days = 2 scopes = { from = fromfrom } } } }
	}
}

# Remove citadel modifier - hidden
country_event = {
	id = btr_citadel.9
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:btr_citadel_planet = {
			remove_modifier = "unexplored_citadel"
		}
	}
}