############################
#
# On Action Events
#
# Written by Annatar
#
############################


namespace = planetarystations_action

# Destroying a Planetary Station after Orbital Bombardment
planet_event = {
	id = planetarystations_action.1
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		planet_devastation >= 100
		has_planet_flag = planetary_station
	}

	immediate = {
		owner = { country_event = { id = planetarystations_action.2 days = 1 } }
		destroy_planetary_station = yes
	}
}

country_event = {
	id = planetarystations_action.2
	title = "planetarystations_action.2.name"
	desc = "planetarystations_action.2.desc"
	picture = GFX_evt_station_wreckage
	show_sound = event_structural_collapse
	location = ROOT
	
	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
	}
}

### Gatekeeper - Pop Arrests
event = {
	id = planetarystations_action.3
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_country = {
			any_owned_planet = {
				has_planet_flag = prison_station
				OR = {
					num_pops < 30
					NOT = { has_modifier = planet_population_control }
				}
			}
			any_owned_planet = {
				NOR = {
					has_planet_flag = prison_station
					has_modifier = penal_colony
				}
				OR = {
					any_owned_pop = { has_job = criminal }
					AND = {
						has_modifier = political_persecution
						any_owned_pop = { has_ethic = ethic_egalitarian }
					}
					AND = {
						has_modifier = hunting_heretics
						any_owned_pop = { has_ethic = ethic_materialist }
					}
				}
				any_owned_pop = { has_job = enforcer }
			}
		}
	}
	
	immediate = {
		every_country = {
			limit = {
				any_owned_planet = {
					has_planet_flag = prison_station
					OR = {
						num_pops < 30
						NOT = { has_modifier = planet_population_control }
					}
				}
				any_owned_planet = {
					NOR = {
						has_planet_flag = prison_station
						has_modifier = penal_colony
					}
					OR = {
						any_owned_pop = { has_job = criminal }
						AND = {
							has_modifier = political_persecution
							any_owned_pop = { has_ethic = ethic_egalitarian }
						}
						AND = {
							has_modifier = hunting_heretics
							any_owned_pop = { has_ethic = ethic_materialist }
						}
					}
					any_owned_pop = { has_job = enforcer }
				}
			}
			every_owned_planet = {
				limit = { 
					NOR = {
						has_planet_flag = prison_station
						has_modifier = penal_colony
					}
					OR = {
						any_owned_pop = { has_job = criminal }
						AND = {
							has_modifier = political_persecution
							any_owned_pop = { has_ethic = ethic_egalitarian }
						}
						AND = {
							has_modifier = hunting_heretics
							any_owned_pop = { has_ethic = ethic_materialist }
						}
					}
					any_owned_pop = { has_job = enforcer }
				}
				random_list = {
					20 = {
						modifier = {
							factor = 3
							OR = {
								has_modifier = anticrime_campaign
								has_modifier = political_persecution
								has_modifier = hunting_heretics
							}
						}
						planet_event = { id = planetarystations_action.4 days = 90 random = 30 }
					}
					80 = {
						#Null
					}
				}
			}
		}
	}
}

### Transferring prisoners
planet_event = {
	id = planetarystations_action.4
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			any_owned_planet = { 
				has_planet_flag = prison_station
				OR = {
					num_pops < 30
					NOT = { has_modifier = planet_population_control }
				}
			}
		}
		OR = {
			any_owned_pop = { has_job = criminal }
			AND = {
				has_modifier = political_persecution
				any_owned_pop = { has_ethic = ethic_egalitarian }
			}
			AND = {
				has_modifier = hunting_heretics
				any_owned_pop = { has_ethic = ethic_materialist }
			}
		}
		any_owned_pop = { has_job = enforcer }
	}
	
	immediate = {
		owner = {
			random_owned_planet = { 
				limit = { 
					has_planet_flag = prison_station
					OR = {
						num_pops < 30
						NOT = { has_modifier = planet_population_control }
					}
				}
				save_event_target_as = prison_station
			}
		}
		
		if = {
			limit = { has_modifier = political_persecution }
			random_owned_pop = {
				limit = { has_ethic = ethic_egalitarian }
				resettle_pop = {
					pop = this
					planet = event_target:prison_station
				}
			}
		}
		else_if ={
			limit = { has_modifier = hunting_heretics }
			random_owned_pop = {
				limit = { has_ethic = ethic_materialist }
				resettle_pop = {
					pop = this
					planet = event_target:prison_station
				}
			}
		}
		else = {
			random_owned_pop = {
				limit = {
					has_job = criminal
				}
				resettle_pop = {
					pop = this
					planet = event_target:prison_station
				}
			}
		}
		
		create_message = {
			type = FELONY_TRANSPORT
			localization = FELONY_TRANSPORT_DESC
			days = 30
			target = THIS
			variable = {
				type = name
				localization = PLANET
				scope = this
			}
			variable = {
				type = name
				localization = PRISON
				scope = event_target:prison_station
			}
		}
	}
}

# Removing the prison station
planet_event = {
	id = planetarystations_action.5
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		from = { is_gestalt = yes }
		has_planet_flag = prison_station
	}

	immediate = {
		remove_planet_flag = prison_station
		validate_planet_buildings_and_districts = yes
	}
}

country_event = {
	id = planetarystations_action.6
	title = "planetarystations_action.6.name"
	desc = "planetarystations_action.6.desc"
	picture = GFX_evt_shattered_planet
	show_sound = event_construction
	location = event_target:cracked_planet
	
	is_triggered_only = yes

	option = {
		name = OK
	}
}